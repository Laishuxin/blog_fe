<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端工具 - 模块化的由来 | Ru Shui</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog_fe/assets/img/logo.png">
    <link rel="manifest" href="/blog_fe/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="Frontend For Everyone">
    <meta property="og:url" content="/blog_fe/cate/tools/1_1-modularize.html">
    <meta property="og:site_name" content="Ru Shui">
    <meta property="og:title" content="前端工具 - 模块化的由来">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Ru Shui">
    <meta property="article:author" content="ru shui">
    <meta property="article:tag" content="tools">
    <meta property="article:published_time" content="2021-06-20T00:00:00.000Z">
    <meta name="keywords" content="backend computer science">
    <meta name="author" content="ru shui">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/blog_fe/assets/css/0.styles.41957911.css" as="style"><link rel="preload" href="/blog_fe/assets/js/app.fe1b108c.js" as="script"><link rel="preload" href="/blog_fe/assets/js/layout-Layout.7bf019d1.js" as="script"><link rel="preload" href="/blog_fe/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.aaefc311.js" as="script"><link rel="preload" href="/blog_fe/assets/js/page-前端工具-模块化的由来.f265e792.js" as="script"><link rel="preload" href="/blog_fe/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.08f9f3fe.js" as="script"><link rel="preload" href="/blog_fe/assets/js/vendors~layout-Blog~layout-Layout.d98152e8.js" as="script"><link rel="prefetch" href="/blog_fe/assets/js/64.edddbf90.js"><link rel="prefetch" href="/blog_fe/assets/js/65.3074097e.js"><link rel="prefetch" href="/blog_fe/assets/js/66.ca796b84.js"><link rel="prefetch" href="/blog_fe/assets/js/67.8b5573dd.js"><link rel="prefetch" href="/blog_fe/assets/js/68.35ba715c.js"><link rel="prefetch" href="/blog_fe/assets/js/layout-Blog.a64e725c.js"><link rel="prefetch" href="/blog_fe/assets/js/layout-NotFound.800d2983.js"><link rel="prefetch" href="/blog_fe/assets/js/layout-Slide.e3f73168.js"><link rel="prefetch" href="/blog_fe/assets/js/page-HTML-基础.3c5f45c8.js"><link rel="prefetch" href="/blog_fe/assets/js/page-HTML-常见问题.4b6da9dc.js"><link rel="prefetch" href="/blog_fe/assets/js/page-HTML.66af9173.js"><link rel="prefetch" href="/blog_fe/assets/js/page-about.2634f73c.js"><link rel="prefetch" href="/blog_fe/assets/js/page-css-快速响应用户事件.472c9529.js"><link rel="prefetch" href="/blog_fe/assets/js/page-css-扇形.c24d1950.js"><link rel="prefetch" href="/blog_fe/assets/js/page-css.2bd3066b.js"><link rel="prefetch" href="/blog_fe/assets/js/page-framework-react.4f8031e2.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-copy.ee62c0f6.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-pre-compile.50ef2e6a.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-this.382e6868.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-事件.4eaf1367.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-事件循环.f4f08876.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-作用域.096da803.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-函数式编程.aa7dc3d8.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-垃圾回收.11453cec.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-对象.f768a1eb.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-小而美的promise缓存.b390172b.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-懒加载与预加载.636d3a83.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-手写部分原生函数.041cd39f.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-浏览器的工作原理及其优化.2e5c62cd.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-深拷贝非递归实现.abd41d0b.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-继承.49432ea1.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-节流.98acc76e.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-防抖.bd57ff72.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js.123f01c8.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-MiniReactHook.3e164bd6.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-hooks.1a5c14a2.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-lifecycle.c75c804c.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-实现react-redux.b8b1974e.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-常用技巧.feac4068.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-常见问题.92cb9bb6.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-踩坑经历.3eb0098d.js"><link rel="prefetch" href="/blog_fe/assets/js/page-ts-infer.2f8bc3db.js"><link rel="prefetch" href="/blog_fe/assets/js/page-ts-常用技巧.6e284b77.js"><link rel="prefetch" href="/blog_fe/assets/js/page-ts.f9faab6c.js"><link rel="prefetch" href="/blog_fe/assets/js/page-vue-用TS实现一个LRU算法.d1ab6a15.js"><link rel="prefetch" href="/blog_fe/assets/js/page-vue2-dispatcher.b8985f2e.js"><link rel="prefetch" href="/blog_fe/assets/js/page-vue2-几个有趣的工具函数.405cc53e.js"><link rel="prefetch" href="/blog_fe/assets/js/page-分类.5025e2ab.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端工具-mock选型.4b623928.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端工具-打包工具-vite.1bebde36.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端工具-插件-vue-lazyload.41534bae.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端工具-构建工具-vite.48db0d2d.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端工具.2edc63a3.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端框架-vue.edb1670f.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端框架-关于vue的常见问题.a38e072f.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端框架.3df2f1f9.js"><link rel="prefetch" href="/blog_fe/assets/js/page-性能优化-性能优化方法论-关键指标的设定.64826a13.js"><link rel="prefetch" href="/blog_fe/assets/js/page-性能优化-浏览器页面相关.65a9e8fb.js"><link rel="prefetch" href="/blog_fe/assets/js/page-性能优化.304383b6.js"><link rel="prefetch" href="/blog_fe/assets/js/page-首页.384bf823.js"><link rel="prefetch" href="/blog_fe/assets/js/vendors~photo-swipe.ccc3dbc0.js"><link rel="prefetch" href="/blog_fe/assets/js/vendors~reveal.667d5c11.js">
    <link rel="stylesheet" href="/blog_fe/assets/css/0.styles.41957911.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/blog_fe/" class="home-link router-link-active"><img src="/blog_fe/assets/img/logo.png" alt="Ru Shui" class="logo"> <!----> <span class="site-name can-hide">Ru Shui</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="switch"><input id="switch" type="checkbox" checked="checked" class="switch-input"> <label for="switch" class="label"><span class="label-content"></span></label></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog_fe/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><a href="/blog_fe/category/" class="nav-link"><!---->
  分类
</a></div><div class="nav-item"><a href="/blog_fe/tag/" class="nav-link"><!---->
  标签
</a></div><div class="nav-item"><a href="/blog_fe/timeline/" class="nav-link"><!---->
  归档
</a></div><div class="nav-item"><a href="/blog_fe/about/" class="nav-link"><!---->
  关于
</a></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info"><div data-balloon-pos="" role="navigation" class="blogger"><img property="image" alt="Blogger Avatar" src="/blog_fe/assets/img/logo.png" class="avatar"> <div property="name" class="name">ru shui</div> <!----></div> <div class="num-wrapper"><div><div class="num">48</div> <div>Articles</div></div> <div><div class="num">15</div> <div>Category</div></div> <div><div class="num">41</div> <div>Tags</div></div> <div><div class="num">48</div> <div>Timeline</div></div></div> <!----></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/blog_fe/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><a href="/blog_fe/category/" class="nav-link"><!---->
  分类
</a></div><div class="nav-item"><a href="/blog_fe/tag/" class="nav-link"><!---->
  标签
</a></div><div class="nav-item"><a href="/blog_fe/timeline/" class="nav-link"><!---->
  归档
</a></div><div class="nav-item"><a href="/blog_fe/about/" class="nav-link"><!---->
  关于
</a></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">模块化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog_fe/cate/tools/1_1-modularize/" aria-current="page" class="active sidebar-link">前端工具 - 模块化的由来</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_fe/cate/tools/1_1-modularize/#发展历程" class="sidebar-link">发展历程</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/tools/1_1-modularize/#模块化初探" class="sidebar-link">模块化初探</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/tools/1_1-modularize/#commonjs" class="sidebar-link">commonJS</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/tools/1_1-modularize/#amd-asynchronous-module-definition" class="sidebar-link">AMD (Asynchronous Module Definition)</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/tools/1_1-modularize/#cmd-common-module-definition" class="sidebar-link">CMD (Common Module Definition)</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/tools/1_1-modularize/#es6-模块化" class="sidebar-link">es6 模块化</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/tools/1_1-modularize/#es6-模块化与-commonjs-的区别" class="sidebar-link">es6 模块化与 commonJS 的区别</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/tools/1_1-modularize/#es6-与-commonjs-处理循环引用" class="sidebar-link">es6 与 commonJS 处理循环引用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_fe/cate/tools/1_1-modularize/#commonjs-2" class="sidebar-link heading3">commonJS</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/tools/1_1-modularize/#es6" class="sidebar-link heading3">es6</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">插件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog_fe/cate/tools/2_1-plugin-vue-lazyload/" class="sidebar-link">前端工具 - 插件 - vue-lazyload</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">构建工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog_fe/cate/tools/3_1-builder-vite/" class="sidebar-link">前端工具 - 打包工具 - vite</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">mock</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog_fe/cate/tools/4_1-mock/" class="sidebar-link">前端工具 - mock 选型</a></li></ul></section></li></ul> <!----> <!----> <div class="content__sidebar-bottom"></div></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/blog_fe/cate/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">分类</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a href="/blog_fe/cate/tools/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">前端工具</span></a> <meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/blog_fe/cate/tools/1_1-modularize/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">前端工具 - 模块化的由来</span></a> <meta property="position" content="3"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">前端工具 - 模块化的由来</span></h1> <div class="page-info"><!----> <span aria-label="Author🖊" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">ru shui</span></span><!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2021-06-20 </span></span><span role="navigation" aria-label="Category🌈" data-balloon-pos="down" class="category-info enable"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon category-icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zm-.854 446.486H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zm446.371-446.486h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zm136.293 813.51H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z" fill="currentColor"></path></svg> <span property="articleSection">Tools</span></span><span aria-label="Tags🏷" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">Tools</span></li><li class="tag clickable tag1"><span role="navigation">Modularize</span></li> <meta property="keywords" content="Tools,Modularize"></ul></span><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 10 min</span> <meta property="timeRequired" content="PT10M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/blog_fe/cate/tools/1_1-modularize/#发展历程" class="anchor-link heading2"><div>发展历程</div></a></li><li class="anchor"><a href="/blog_fe/cate/tools/1_1-modularize/#模块化初探" class="anchor-link heading2"><div>模块化初探</div></a></li><li class="anchor"><a href="/blog_fe/cate/tools/1_1-modularize/#commonjs" class="anchor-link heading2"><div>commonJS</div></a></li><li class="anchor"><a href="/blog_fe/cate/tools/1_1-modularize/#amd-asynchronous-module-definition" class="anchor-link heading2"><div>AMD (Asynchronous Module Definition)</div></a></li><li class="anchor"><a href="/blog_fe/cate/tools/1_1-modularize/#cmd-common-module-definition" class="anchor-link heading2"><div>CMD (Common Module Definition)</div></a></li><li class="anchor"><a href="/blog_fe/cate/tools/1_1-modularize/#es6-模块化" class="anchor-link heading2"><div>es6 模块化</div></a></li><li class="anchor"><a href="/blog_fe/cate/tools/1_1-modularize/#es6-模块化与-commonjs-的区别" class="anchor-link heading2"><div>es6 模块化与 commonJS 的区别</div></a></li><li class="anchor"><a href="/blog_fe/cate/tools/1_1-modularize/#es6-与-commonjs-处理循环引用" class="anchor-link heading2"><div>es6 与 commonJS 处理循环引用</div></a></li><li class="anchor"><a href="/blog_fe/cate/tools/1_1-modularize/#commonjs-2" class="anchor-link heading3"><div>commonJS</div></a></li><li class="anchor"><a href="/blog_fe/cate/tools/1_1-modularize/#es6" class="anchor-link heading3"><div>es6</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><p>前端模块化要解决哪些问题？</p> <h2 id="发展历程"><a href="#发展历程" class="header-anchor">#</a> 发展历程</h2> <p>在早期的前端开发中，并没有模块化的概念。
甚至在 IE6 以前，浏览器还没有 js 引擎，
早期的 js 文件非常简单，一般通过 <code>script</code> 直接引入
或者直接在 <code>script</code> 标签中直接编写 js 代码，也就是采用
单文件进行管理 js 代码。</p> <p>随着互联网的发展，前端业务逐渐变得复杂，使用 js 的情景越来越多，
业务量的增长也让 js 的代码量水涨船高，此时，还采用单个文件来维护
js 代码的话，一来不方便维护，同时用户请求的时间也随之变长了。再者，
采用单文件的方式不利于代码的复用。</p> <p>于是，就有了一种新的文件管理方式，就是不同的页面对应不同的 js 文件，
即，以页面为基准将 js 代码划分为不同的脚本块。这是早期的模块化思维。</p> <p>为了实现代码的复用，于是就出现了把公共的代码放在同一个文件中，
不同的页面按需引用。但是，这种做法也有一点问题，考虑下面的代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// common1</span>
<span class="token keyword">function</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>作为公共的脚本，不同页面可以引用改文件。但是问题在于如果 A 页面
<strong>只需要</strong>用到改公共脚本中的 <code>func1</code>，这种引用发生或导致 A 页面
导入许多无用的东西，这显然不合理。也就是说，采用<strong>以页面为基准</strong>的
引用方式存在不足了。</p> <p>于是就有了以程序为基准的脚本划分方式。</p> <h2 id="模块化初探"><a href="#模块化初探" class="header-anchor">#</a> 模块化初探</h2> <p>我们把一个程序划分为多个模块（模块 A，模块 B，和模块 C）进行管理。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ./module-a.js</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>

<span class="token comment">// ./module-b.js</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'module b'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// ./module-c.js</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">*</span> item<span class="token punctuation">)</span>

<span class="token comment">// ./main.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">a = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">b = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">c = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- index.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./module-a.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./module-b.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./module-c.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>我们“定义”了三个模块，然后在 <code>main.js</code> 使用了这些模块。
其次，模块与模块之间存在引用，即 <code>module-c.js</code> 引用了 <code>module-a.js</code>。
然后，我们还需要在相应页面 <code>index.html</code> 中导入主程序。</p> <p>这种模块化的方式也是很有问题的，一来由于变量是定义在全局作用域上，
污染了全局作用域。再者是这种模块化没能解决模块之间的依赖问题。
也就是，我们根本不知道当前模块引用了哪些其他模块（例如：在 <code>module-c</code> 中，
我们引用了 <code>module-a</code>，但单从代码上看我们根本不得而知）。同时，当我们
使用模块的时候，我们还需要按照模块引用的顺序对模块进行导入，如果顺序不对
会导致整个程序运行奔溃（例如：我们在 <code>index.html</code> 中现导入 <code>main.js</code> 再
导入其他模块，显然程序会奔溃）。</p> <p>回到最初的问题：模块化究竟要解决什么问题？这里可以给出答案。
模块化需要解决：</p> <ol><li>全局污染。</li> <li>模块污染。</li></ol> <p>为了解决上述的两个问题，引入了闭包来实现模块化。</p> <p>利用闭包延长函数的作用域的同时，我们可以解决全局污染的问题。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ./module-a.js</span>
<span class="token keyword">var</span> moduleA <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> a<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ./module-b.js</span>
<span class="token keyword">var</span> moduleB <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'module b'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    b<span class="token operator">:</span> b<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ./module-c.js</span>
<span class="token keyword">var</span> moduleC <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> c <span class="token operator">=</span> moduleA<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">*</span> item<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    c<span class="token operator">:</span> c<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ./main.js</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> moduleA<span class="token punctuation">.</span>a
<span class="token keyword">var</span> b <span class="token operator">=</span> moduleB<span class="token punctuation">.</span>b
<span class="token keyword">var</span> c <span class="token operator">=</span> moduleC<span class="token punctuation">.</span>c

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">module closure a = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">module closure b = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">module closure c = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>虽然我们解决了避免全局污染的问题，还有一个模块之间的相互依赖
还没有解决，下面就来解决这个问题。我们的程序中，只有 <code>module-c</code> 和
主程序引用
其他模块，我们对这两个文件进行修改。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ./module-c.js</span>
<span class="token keyword">var</span> moduleC <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">moduleA</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> c <span class="token operator">=</span> moduleA<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">*</span> item<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    c<span class="token operator">:</span> c<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>moduleA<span class="token punctuation">)</span>

<span class="token comment">// ./main.js</span>
<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">moduleA<span class="token punctuation">,</span> moduleB<span class="token punctuation">,</span> moduleC</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> moduleA<span class="token punctuation">.</span>a
  <span class="token keyword">var</span> b <span class="token operator">=</span> moduleB<span class="token punctuation">.</span>b
  <span class="token keyword">var</span> c <span class="token operator">=</span> moduleC<span class="token punctuation">.</span>c

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">module closure a = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">module closure b = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">module closure c = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>moduleA<span class="token punctuation">,</span> moduleB<span class="token punctuation">,</span> moduleC<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>我们采用模块注入的方式，将模块 A 注入到模块 C 中，从而实现模块之间的依赖关系。</p> <h2 id="commonjs"><a href="#commonjs" class="header-anchor">#</a> commonJS</h2> <p>nodejs 中提供 <code>require</code> 和 <code>module.exports</code> 进行模块化管理。</p> <p>但是，nodejs 提供的模块化管理方式只能运行在 node 环境上，想要运行
在浏览器上的话，还需要 webpack 提供支持。</p> <p>commonJS 所提供的模块化管理方式具有如下特点：</p> <ol><li>同步进行。</li> <li>只要引用就进行实例化。</li> <li>缓存模块。每引用一个模块就对引用的模块进行缓存。</li></ol> <h2 id="amd-asynchronous-module-definition"><a href="#amd-asynchronous-module-definition" class="header-anchor">#</a> AMD (Asynchronous Module Definition)</h2> <p>之所以会有 AMD，是因为 commonJS 需要在 node 环境上才能运行。
AMD 的出现就是为了可以在浏览器上直接使用类似于 <code>require</code> 的模块化
管理方式。</p> <p>与 commonJS 的模块化不同，AMD 采用的是异步模块的管理方式。
其使用方法如下：</p> <ol><li><p>先引入 <code>require.js</code>。AMD 需要借助 <code>require.js</code> 实现。</p></li> <li><p>定义模块和使用模块。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 定义模块。</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'moduleName'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'dependency1'</span><span class="token punctuation">,</span> <span class="token string">'dependency2'</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用模块。</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dependency1'</span><span class="token punctuation">,</span> <span class="token string">'dependency2'</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">inject1<span class="token punctuation">,</span> inject2<span class="token punctuation">,</span> <span class="token operator">...</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <p>还是用刚才的示例，不过这次我们使用 AMD 实现。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ./module-a.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'module-a'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> a<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ./module-b.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'module-b'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'module b'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    b<span class="token operator">:</span> b<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ./module-c.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'module-c'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'module-a'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">moduleA</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> c <span class="token operator">=</span> moduleA<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> item <span class="token operator">*</span> item
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    c<span class="token operator">:</span> c<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ./main.js</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'module-a'</span><span class="token punctuation">,</span> <span class="token string">'module-b'</span><span class="token punctuation">,</span> <span class="token string">'module-c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
  <span class="token parameter">moduleA<span class="token punctuation">,</span>
  moduleB<span class="token punctuation">,</span>
  moduleC<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> moduleA<span class="token punctuation">.</span>a
  <span class="token keyword">var</span> b <span class="token operator">=</span> moduleB<span class="token punctuation">.</span>b
  <span class="token keyword">var</span> c <span class="token operator">=</span> moduleC<span class="token punctuation">.</span>c
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">commonjs a = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">commonjs b = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">commonjs c = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./require.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>同时，<code>require</code> 也提供了自定义模块路径的方式。具体使用方法如下：
<code>require.config({paths: { moduleName: 'modulePath' }})</code></p> <p>通过 commonJS 和 amd 的模块化管理方式，我们可以解决模块之间的相互依赖
关系的管理，所以，在 <code>index.html</code> 中，我们只需要引入 <code>main.js</code> 而不需要
在引用其他 js 文文件。模块之间的相互依赖关系由它们帮我们进行管理。</p> <p>amd 采用的是异步加载的方式，而且在使用模块时先将依赖到的模块进行加载，
加载完成后才会执行回调函数（这种方式也叫<strong>前置依赖</strong>）。来看通过 amd 使用模块后的 html 代码：
<img src="/blog_fe/assets/img/2021-06-21-13-07-28.7d809832.png" alt=""></p> <p>可以看到，amd 会在 <code>head</code> 中先加载依赖，而且是采用 <code>async</code> 的方式进行加载的。
通过回调函数的方式，保证了异步加载模块的顺序问题。</p> <h2 id="cmd-common-module-definition"><a href="#cmd-common-module-definition" class="header-anchor">#</a> CMD (Common Module Definition)</h2> <p>CMD 的实现需要借助 <code>sea.js</code>。
其特点是：</p> <ol><li>依赖就近。</li> <li>按需加载。</li></ol> <p>使用方式如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 1. 定义。</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 使用</span>
seajs<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'modulePath'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">moduleA<span class="token punctuation">,</span> moduleB<span class="token punctuation">,</span> moduleC</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="es6-模块化"><a href="#es6-模块化" class="header-anchor">#</a> es6 模块化</h2> <p>ECMA 在 es6 中正式给出了 js 模块化的管理。
通过采用 <code>import</code> 和 <code>export</code> 的方式来实现模块的导入
与导出。只要 js 文件中使用到了 <code>import</code> 和 <code>export</code>，
我们就可以认为这是一个模块。</p> <p>下面让我们将之前的示例用 es6 提供的模块化重新编写一下。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ./module-a.js</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span>

<span class="token comment">// ./module-b.js</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span>

<span class="token comment">// ./module-c.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./module-a.js'</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> item <span class="token operator">*</span> item
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> c <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>使用 es6 进行模块管理还需要浏览器支持，所以在引用时，
需要指明改文件类型为 <code>module</code>。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./main.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以看到 es6 给我们提供的模块化管理，实现起来其代码是
非常简洁的。</p> <h2 id="es6-模块化与-commonjs-的区别"><a href="#es6-模块化与-commonjs-的区别" class="header-anchor">#</a> es6 模块化与 commonJS 的区别</h2> <ol><li>commonJS 模块输出的是一个值拷贝（值得注意的是，这种拷贝是浅拷贝），
而 es6 模块输出的是值的引用。</li> <li>commonJS 是运行时加载，而 es6 是编译输出接口。</li></ol> <p>要想解释第一点，我们来考虑如下的代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// common js 实现模块化</span>
<span class="token comment">// ./commonjs-module-a.js</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">0</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  a<span class="token operator">++</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// commonjs-main.js</span>
<span class="token keyword">var</span> moduleA <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./commonjs-module-a'</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'commonjs a = '</span><span class="token punctuation">,</span> moduleA<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token comment">// commonjs a = 0</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token comment">// es6 实现模块化</span>
<span class="token comment">// ./es6-module-a.js</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">0</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  a<span class="token operator">++</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./es6-module-a.js'</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'es6 a = '</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token comment">// es6 a = 1;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>通过输出可以验证，es6 和 commonJS 的对模块的定义是不同的。</p> <p>对于第二点，是因为 commonJS 加载的模块是一个对象，对象
只有在脚本运行完成后才会生成。而 es6 模块并不是对象，它只是
对外提供一种静态的定义，在代码的编译解析阶段就生成</p> <h2 id="es6-与-commonjs-处理循环引用"><a href="#es6-与-commonjs-处理循环引用" class="header-anchor">#</a> es6 与 commonJS 处理循环引用</h2> <h3 id="commonjs-2"><a href="#commonjs-2" class="header-anchor">#</a> commonJS</h3> <p>在 commonJS 中，每一个模块就是一个实例。 cjs 会在
实例化模块的时候，设置一个标识位 <code>loaded = false</code>，
当模块加载完成后，<code>loaded = true</code>。</p> <p>如果在后面加载过程中，引用到别的模块，cjs 引擎会去加载
引用的模块。如果遇到循环引用的时候，cjs 会忽略改模块的
加载，继续执行当前模块。所以，在 cjs 中如果遇到循环引用
的时候，我们只能拿到 前一个模块已经加载完成的数据。
来看下面的代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ./cjs-module-a.js</span>
exports<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cjs-module-b'</span><span class="token punctuation">)</span>
<span class="token comment">// moduleA: b.done =  true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleA: b.done = '</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>done<span class="token punctuation">)</span>

exports<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment">// moduleA: module has been loaded, loaded =  true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleA: module has been loaded, loaded = '</span><span class="token punctuation">,</span> exports<span class="token punctuation">.</span>done<span class="token punctuation">)</span>

<span class="token comment">// ./cjs-module-b.js</span>
exports<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cjs-module-a'</span><span class="token punctuation">)</span>
<span class="token comment">// moduleB: a.done =  false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleB: a.done = '</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>done<span class="token punctuation">)</span>

exports<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment">// moduleB: module has been loaded, loaded =  true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleB: module has been loaded, loaded = '</span><span class="token punctuation">,</span> exports<span class="token punctuation">.</span>done<span class="token punctuation">)</span>

<span class="token comment">// ./cjs-main.js</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cjs-module-a'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cjs-module-b'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'main: a.done = '</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>done<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'main: b.done = '</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>done<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><img src="/blog_fe/assets/img/cjs-loading.6201f5b1.gif" alt="cjs-loading"></p> <p>从动画我们可以理解 cjs 对模块的加载方式。
首先，加载 <code>module-a</code>，遇到 <code>require('module-b')</code> 时，
加载 <code>module-b</code>。
加载 <code>module-b</code> 时，又引用了 <code>require('module-a')</code>，
也就是循环引用了，
这时候 <code>cjs</code> 引擎不会再去加载 <code>module-a</code>，但是，在 <code>module-b</code>
中我们可以使用到 <code>module-a</code> 中已经加载的部分，这就是为什么
打印出 <code>moduleB: a.done = false</code>。加载完 <code>module-b</code> 后，
继续加载 <code>module-a</code>，所以输出 <code>moduleA: b.done = true</code>。</p> <h3 id="es6"><a href="#es6" class="header-anchor">#</a> es6</h3> <p>es6 的加载过程与 cjs 类似，但是由于 es6 的模块化采用的是
数据的引用方式，所以确保了数据是最新的，但这样作也可能带来
一定的坏处，也就在循环引用的时候会出现引用错误。
来看下面的代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ./module-a.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> done <span class="token keyword">as</span> BDone <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./es6-module-b.js'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleA: start loading...'</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">let</span> done <span class="token operator">=</span> <span class="token boolean">false</span>
done <span class="token operator">=</span> <span class="token boolean">true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleA: moduleA.done = '</span><span class="token punctuation">,</span> done<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleA: moduleB.done = '</span><span class="token punctuation">,</span> BDone<span class="token punctuation">)</span>

<span class="token comment">// ./module-a.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> done <span class="token keyword">as</span> ADone <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./es6-module-a.js'</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> done <span class="token operator">=</span> <span class="token boolean">false</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleB: start loading...'</span><span class="token punctuation">)</span>
<span class="token comment">// Uncaught ReferenceError: Cannot access 'ADone' before initialization</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleB: ADone = '</span><span class="token punctuation">,</span> ADone<span class="token punctuation">)</span>

done <span class="token operator">=</span> <span class="token boolean">true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleB: b.done = '</span><span class="token punctuation">,</span> done<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>上面代码执行时会抛出一个 <code>ReferenceError</code>，这是因为
<code>module-b</code> 中在执行的过程中，<code>module-a</code> 还没有声明
变量 <code>done</code>，这就就像 ts 中的接口，我们知道有这个值
的存在，但是，这个值是否定义了还得看具体的运行环境。</p> <p>我们可以将变量该换成函数的方式来解决这个问题。
这是因为函数具有提升作用，也就是在 <code>module-a</code> 中
的 <code>import {} from './module-b.js</code> 执行之前，
改函数就定义好了。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ./module-a.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> done <span class="token keyword">as</span> BDone <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./es6-module-b.js'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleA: start loading...'</span><span class="token punctuation">)</span>

<span class="token comment">// export let done = false;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
<span class="token comment">// done = true;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleA: moduleA.done = '</span><span class="token punctuation">,</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleA: moduleB.done = '</span><span class="token punctuation">,</span> BDone<span class="token punctuation">)</span>

<span class="token comment">// ./module-b.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> done <span class="token keyword">as</span> ADone <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./es6-module-a.js'</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> done <span class="token operator">=</span> <span class="token boolean">false</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleB: start loading...'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleB: ADone = '</span><span class="token punctuation">,</span> <span class="token function">ADone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

done <span class="token operator">=</span> <span class="token boolean">true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleB: b.done = '</span><span class="token punctuation">,</span> done<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>同样的道理，我们也不能使用箭头函数，因为箭头函数也不具备
变量提升的作用。</p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">September 12, 2021 11:40</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 15622971239@163.com" class="contributor">
          Laishuxin
        </span> , <span title="email: 56504759+Laishuxin@users.noreply.github.com" class="contributor">
          Laishuxin
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog_fe/cate/tools/2_1-plugin-vue-lazyload/">
        前端工具 - 插件 - vue-lazyload
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <!----> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><!----> <div class="footer"><h2 style="width:100%; min-width: 100%;">Ru Shui</h2></div> <div class="copyright">MIT Licensed | Copyright © 2021-present Ru Shui</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/blog_fe/assets/js/app.fe1b108c.js" defer></script><script src="/blog_fe/assets/js/layout-Layout.7bf019d1.js" defer></script><script src="/blog_fe/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.aaefc311.js" defer></script><script src="/blog_fe/assets/js/page-前端工具-模块化的由来.f265e792.js" defer></script><script src="/blog_fe/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.08f9f3fe.js" defer></script><script src="/blog_fe/assets/js/vendors~layout-Blog~layout-Layout.d98152e8.js" defer></script>
  </body>
</html>
