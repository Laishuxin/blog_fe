<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>js - 懒加载与预加载 | Ru Shui</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog_fe/assets/img/logo.png">
    <link rel="manifest" href="/blog_fe/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="Frontend For Everyone">
    <meta property="og:url" content="/blog_fe/cate/js/4-lazy-load.html">
    <meta property="og:site_name" content="Ru Shui">
    <meta property="og:title" content="js - 懒加载与预加载">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Ru Shui">
    <meta property="article:author" content="ru shui">
    <meta property="article:tag" content="javascript">
    <meta property="article:published_time" content="2021-07-08T00:00:00.000Z">
    <meta name="keywords" content="backend computer science">
    <meta name="author" content="ru shui">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/blog_fe/assets/css/0.styles.41957911.css" as="style"><link rel="preload" href="/blog_fe/assets/js/app.fe1b108c.js" as="script"><link rel="preload" href="/blog_fe/assets/js/layout-Layout.7bf019d1.js" as="script"><link rel="preload" href="/blog_fe/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.aaefc311.js" as="script"><link rel="preload" href="/blog_fe/assets/js/page-js-懒加载与预加载.636d3a83.js" as="script"><link rel="preload" href="/blog_fe/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.08f9f3fe.js" as="script"><link rel="preload" href="/blog_fe/assets/js/vendors~layout-Blog~layout-Layout.d98152e8.js" as="script"><link rel="prefetch" href="/blog_fe/assets/js/64.edddbf90.js"><link rel="prefetch" href="/blog_fe/assets/js/65.3074097e.js"><link rel="prefetch" href="/blog_fe/assets/js/66.ca796b84.js"><link rel="prefetch" href="/blog_fe/assets/js/67.8b5573dd.js"><link rel="prefetch" href="/blog_fe/assets/js/68.35ba715c.js"><link rel="prefetch" href="/blog_fe/assets/js/layout-Blog.a64e725c.js"><link rel="prefetch" href="/blog_fe/assets/js/layout-NotFound.800d2983.js"><link rel="prefetch" href="/blog_fe/assets/js/layout-Slide.e3f73168.js"><link rel="prefetch" href="/blog_fe/assets/js/page-HTML-基础.3c5f45c8.js"><link rel="prefetch" href="/blog_fe/assets/js/page-HTML-常见问题.4b6da9dc.js"><link rel="prefetch" href="/blog_fe/assets/js/page-HTML.66af9173.js"><link rel="prefetch" href="/blog_fe/assets/js/page-about.2634f73c.js"><link rel="prefetch" href="/blog_fe/assets/js/page-css-快速响应用户事件.472c9529.js"><link rel="prefetch" href="/blog_fe/assets/js/page-css-扇形.c24d1950.js"><link rel="prefetch" href="/blog_fe/assets/js/page-css.2bd3066b.js"><link rel="prefetch" href="/blog_fe/assets/js/page-framework-react.4f8031e2.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-copy.ee62c0f6.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-pre-compile.50ef2e6a.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-this.382e6868.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-事件.4eaf1367.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-事件循环.f4f08876.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-作用域.096da803.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-函数式编程.aa7dc3d8.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-垃圾回收.11453cec.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-对象.f768a1eb.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-小而美的promise缓存.b390172b.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-手写部分原生函数.041cd39f.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-浏览器的工作原理及其优化.2e5c62cd.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-深拷贝非递归实现.abd41d0b.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-继承.49432ea1.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-节流.98acc76e.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js-防抖.bd57ff72.js"><link rel="prefetch" href="/blog_fe/assets/js/page-js.123f01c8.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-MiniReactHook.3e164bd6.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-hooks.1a5c14a2.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-lifecycle.c75c804c.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-实现react-redux.b8b1974e.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-常用技巧.feac4068.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-常见问题.92cb9bb6.js"><link rel="prefetch" href="/blog_fe/assets/js/page-react-踩坑经历.3eb0098d.js"><link rel="prefetch" href="/blog_fe/assets/js/page-ts-infer.2f8bc3db.js"><link rel="prefetch" href="/blog_fe/assets/js/page-ts-常用技巧.6e284b77.js"><link rel="prefetch" href="/blog_fe/assets/js/page-ts.f9faab6c.js"><link rel="prefetch" href="/blog_fe/assets/js/page-vue-用TS实现一个LRU算法.d1ab6a15.js"><link rel="prefetch" href="/blog_fe/assets/js/page-vue2-dispatcher.b8985f2e.js"><link rel="prefetch" href="/blog_fe/assets/js/page-vue2-几个有趣的工具函数.405cc53e.js"><link rel="prefetch" href="/blog_fe/assets/js/page-分类.5025e2ab.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端工具-mock选型.4b623928.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端工具-打包工具-vite.1bebde36.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端工具-插件-vue-lazyload.41534bae.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端工具-构建工具-vite.48db0d2d.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端工具-模块化的由来.f265e792.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端工具.2edc63a3.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端框架-vue.edb1670f.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端框架-关于vue的常见问题.a38e072f.js"><link rel="prefetch" href="/blog_fe/assets/js/page-前端框架.3df2f1f9.js"><link rel="prefetch" href="/blog_fe/assets/js/page-性能优化-性能优化方法论-关键指标的设定.64826a13.js"><link rel="prefetch" href="/blog_fe/assets/js/page-性能优化-浏览器页面相关.65a9e8fb.js"><link rel="prefetch" href="/blog_fe/assets/js/page-性能优化.304383b6.js"><link rel="prefetch" href="/blog_fe/assets/js/page-首页.384bf823.js"><link rel="prefetch" href="/blog_fe/assets/js/vendors~photo-swipe.ccc3dbc0.js"><link rel="prefetch" href="/blog_fe/assets/js/vendors~reveal.667d5c11.js">
    <link rel="stylesheet" href="/blog_fe/assets/css/0.styles.41957911.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/blog_fe/" class="home-link router-link-active"><img src="/blog_fe/assets/img/logo.png" alt="Ru Shui" class="logo"> <!----> <span class="site-name can-hide">Ru Shui</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="switch"><input id="switch" type="checkbox" checked="checked" class="switch-input"> <label for="switch" class="label"><span class="label-content"></span></label></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog_fe/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><a href="/blog_fe/category/" class="nav-link"><!---->
  分类
</a></div><div class="nav-item"><a href="/blog_fe/tag/" class="nav-link"><!---->
  标签
</a></div><div class="nav-item"><a href="/blog_fe/timeline/" class="nav-link"><!---->
  归档
</a></div><div class="nav-item"><a href="/blog_fe/about/" class="nav-link"><!---->
  关于
</a></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info"><div data-balloon-pos="" role="navigation" class="blogger"><img property="image" alt="Blogger Avatar" src="/blog_fe/assets/img/logo.png" class="avatar"> <div property="name" class="name">ru shui</div> <!----></div> <div class="num-wrapper"><div><div class="num">48</div> <div>Articles</div></div> <div><div class="num">15</div> <div>Category</div></div> <div><div class="num">41</div> <div>Tags</div></div> <div><div class="num">48</div> <div>Timeline</div></div></div> <!----></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/blog_fe/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><a href="/blog_fe/category/" class="nav-link"><!---->
  分类
</a></div><div class="nav-item"><a href="/blog_fe/tag/" class="nav-link"><!---->
  标签
</a></div><div class="nav-item"><a href="/blog_fe/timeline/" class="nav-link"><!---->
  归档
</a></div><div class="nav-item"><a href="/blog_fe/about/" class="nav-link"><!---->
  关于
</a></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><a href="/blog_fe/cate/js/1-event/" class="sidebar-link">js - 事件</a></li><li><a href="/blog_fe/cate/js/10-inherit/" class="sidebar-link">js - 继承</a></li><li><a href="/blog_fe/cate/js/11-scope/" class="sidebar-link">js - 作用域</a></li><li><a href="/blog_fe/cate/js/12-garbage-collection/" class="sidebar-link">js - 垃圾回收</a></li><li><a href="/blog_fe/cate/js/13-event-loop/" class="sidebar-link">js - 事件循环</a></li><li><a href="/blog_fe/cate/js/14-override/" class="sidebar-link">js - 手写部分原生函数</a></li><li><a href="/blog_fe/cate/js/15-promise-cache/" class="sidebar-link">js - 小而美的 promise 缓存</a></li><li><a href="/blog_fe/cate/js/16-browser-working-principle/" class="sidebar-link">js - 浏览器的工作原理及其优化</a></li><li><a href="/blog_fe/cate/js/17-deep-copy/" class="sidebar-link">js - 深拷贝非递归实现</a></li><li><a href="/blog_fe/cate/js/2-debounce/" class="sidebar-link">js - 节流</a></li><li><a href="/blog_fe/cate/js/3-throttle/" class="sidebar-link">js - 防抖</a></li><li><a href="/blog_fe/cate/js/4-lazy-load/" aria-current="page" class="active sidebar-link">js - 懒加载与预加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_fe/cate/js/4-lazy-load/#懒加载" class="sidebar-link">懒加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_fe/cate/js/4-lazy-load/#写在前面" class="sidebar-link heading3">写在前面</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/js/4-lazy-load/#实现原理" class="sidebar-link heading3">实现原理</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/js/4-lazy-load/#判断元素是否在可视区" class="sidebar-link heading3">判断元素是否在可视区</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/js/4-lazy-load/#实现懒加载" class="sidebar-link heading3">实现懒加载</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/js/4-lazy-load/#另一种方式" class="sidebar-link heading3">另一种方式</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/js/4-lazy-load/#图片预加载" class="sidebar-link">图片预加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_fe/cate/js/4-lazy-load/#无序加载" class="sidebar-link heading3">无序加载</a></li><li class="sidebar-sub-header"><a href="/blog_fe/cate/js/4-lazy-load/#有序加载" class="sidebar-link heading3">有序加载</a></li></ul></li></ul></li><li><a href="/blog_fe/cate/js/5-functional-programming/" class="sidebar-link">js - 函数式编程</a></li><li><a href="/blog_fe/cate/js/6-pre-compile/" class="sidebar-link">js - pre-compile</a></li><li><a href="/blog_fe/cate/js/7-this/" class="sidebar-link">js - this</a></li><li><a href="/blog_fe/cate/js/8-copy/" class="sidebar-link">js - copy</a></li><li><a href="/blog_fe/cate/js/9-object/" class="sidebar-link">js - 对象</a></li></ul> <!----> <!----> <div class="content__sidebar-bottom"></div></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/blog_fe/cate/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">分类</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a href="/blog_fe/cate/js/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">js</span></a> <meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/blog_fe/cate/js/4-lazy-load/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">js - 懒加载与预加载</span></a> <meta property="position" content="3"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">js - 懒加载与预加载</span></h1> <div class="page-info"><!----> <span aria-label="Author🖊" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">ru shui</span></span><!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2021-07-08 </span></span><span role="navigation" aria-label="Category🌈" data-balloon-pos="down" class="category-info enable"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon category-icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zm-.854 446.486H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zm446.371-446.486h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zm136.293 813.51H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z" fill="currentColor"></path></svg> <span property="articleSection">Javascript</span></span><span aria-label="Tags🏷" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">Javascript</span></li><li class="tag clickable tag1"><span role="navigation">Lazy load</span></li><li class="tag clickable tag2"><span role="navigation">Preload</span></li> <meta property="keywords" content="Javascript,Lazy load,Preload"></ul></span><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 5 min</span> <meta property="timeRequired" content="PT5M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/blog_fe/cate/js/4-lazy-load/#懒加载" class="anchor-link heading2"><div>懒加载</div></a></li><li class="anchor"><a href="/blog_fe/cate/js/4-lazy-load/#写在前面" class="anchor-link heading3"><div>写在前面</div></a></li><li class="anchor"><a href="/blog_fe/cate/js/4-lazy-load/#实现原理" class="anchor-link heading3"><div>实现原理</div></a></li><li class="anchor"><a href="/blog_fe/cate/js/4-lazy-load/#判断元素是否在可视区" class="anchor-link heading3"><div>判断元素是否在可视区</div></a></li><li class="anchor"><a href="/blog_fe/cate/js/4-lazy-load/#实现懒加载" class="anchor-link heading3"><div>实现懒加载</div></a></li><li class="anchor"><a href="/blog_fe/cate/js/4-lazy-load/#另一种方式" class="anchor-link heading3"><div>另一种方式</div></a></li><li class="anchor"><a href="/blog_fe/cate/js/4-lazy-load/#图片预加载" class="anchor-link heading2"><div>图片预加载</div></a></li><li class="anchor"><a href="/blog_fe/cate/js/4-lazy-load/#无序加载" class="anchor-link heading3"><div>无序加载</div></a></li><li class="anchor"><a href="/blog_fe/cate/js/4-lazy-load/#有序加载" class="anchor-link heading3"><div>有序加载</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h2 id="懒加载"><a href="#懒加载" class="header-anchor">#</a> 懒加载</h2> <h3 id="写在前面"><a href="#写在前面" class="header-anchor">#</a> 写在前面</h3> <p>这里的图片懒加载指的是当图片滑动到可视区域内才进行加载。但是，这种加载是按照顺序执行的，
也就是如果用户一开始立马滑动到下方的话，当前视口上面的所有图片还是会被加载的。</p> <h3 id="实现原理"><a href="#实现原理" class="header-anchor">#</a> 实现原理</h3> <p>图片懒加载的实现原理：</p> <ol><li>先使用一张默认的图片填充 img。</li> <li>将真正的 src 放在 <code>data-src</code> 里面。</li> <li>当滚动窗口滚动到当前图片的位置时，将 <code>img.src = img.dataset['src']</code>。</li> <li>完成后删除 <code>img.dataset['src']</code>。</li></ol> <p>img 的模板标签如下：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pod.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dest1.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="判断元素是否在可视区"><a href="#判断元素是否在可视区" class="header-anchor">#</a> 判断元素是否在可视区</h3> <p>判断图片是否进入可视区可以采用如下代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/**
 * 判断元素是否在可视区范围。
 * @param { HTMLElement } el 待判断的元素节点。
 * @param { HTMLElement } parent 顶层的滚动元素
 * @returns { boolean } true 如果 el 在可视区范围，否则 false
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isInVisibleArea</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cHeight <span class="token operator">=</span> parent<span class="token punctuation">.</span>clientHeight
  <span class="token keyword">const</span> sTop <span class="token operator">=</span> parent<span class="token punctuation">.</span>scrollTop
  <span class="token keyword">const</span> oTop <span class="token operator">=</span> el<span class="token punctuation">.</span>offsetTop
  <span class="token keyword">return</span> oTop <span class="token operator">&lt;</span> cHeight <span class="token operator">+</span> sTop
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="实现懒加载"><a href="#实现懒加载" class="header-anchor">#</a> 实现懒加载</h3> <p>先来看我们的模板：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./images/pad.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{src}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{name}}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="另一种方式"><a href="#另一种方式" class="header-anchor">#</a> 另一种方式</h3> <p>现代浏览器为我们提供了判断元素是否在可视化视口内的 API，
根据这个 API 我们可以很容易实现图片懒加载：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/1.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/2.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/3.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic3'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/4.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic4'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/5.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic5'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/6.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic6'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/7.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic7'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/8.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic8'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> template <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'template'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML
<span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.img-list'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> imgListStr <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> template<span class="token punctuation">)</span>
container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> imgListStr
<span class="token keyword">const</span> images <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">const</span> length <span class="token operator">=</span> images<span class="token punctuation">.</span>length
<span class="token keyword">const</span> io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> entry<span class="token punctuation">.</span>target
    <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>intersectionRatio <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">.</span>src <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-src'</span><span class="token punctuation">)</span>
      target<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'data-src'</span><span class="token punctuation">)</span>
      io<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count <span class="token operator">===</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        io<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

images<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> template</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> imgStr
  <span class="token keyword">const</span> imgStrArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    imgStr <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">{{(.*?)}}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        src<span class="token operator">:</span> item<span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    imgStrArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>imgStr<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> imgStrArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>我们定义了一个 <code>img-list</code> 的容器，用于存放图片，
我们将 <code>template</code> 中的代码作为我们的模板 html。
其中，<code>./images/pad.png</code> 是一张背景图片，相当于骨架图。</p> <p>下面是我们从后端获取过来的数据：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/1.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/2.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/3.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic3'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/4.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic4'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/5.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic5'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/6.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic6'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/7.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic7'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/8.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic8'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>获取完数据后，我们将数据渲染到模板上。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> template <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'template'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML
<span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.img-list'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> imgListStr <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> template<span class="token punctuation">)</span>
container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> imgListStr

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> template</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> imgStr
  <span class="token keyword">const</span> imgStrArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    imgStr <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">{{(.*?)}}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        src<span class="token operator">:</span> item<span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    imgStrArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>imgStr<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> imgStrArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>其次，我们还需要绑定一个 <code>scroll</code> 事件，同时当 <code>window.onload</code> 的时候，我们也应该
加载一部分图片：</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">bindEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> images <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.img-item img'</span><span class="token punctuation">)</span>

  window<span class="token punctuation">.</span>onload <span class="token operator">=</span> window<span class="token punctuation">.</span>onscroll <span class="token operator">=</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token function">lazyLoad</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>再解释为什么要使用节流函数之前，我们先来看一下 <code>lazyLoad</code> 的实现：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">lazyLoad</span><span class="token punctuation">(</span><span class="token parameter">images</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> length <span class="token operator">=</span> images<span class="token punctuation">.</span>length
  <span class="token keyword">const</span> doc <span class="token operator">=</span> document
  <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">0</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cHeight <span class="token operator">=</span> doc<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientHeight
    <span class="token keyword">const</span> scrollTop <span class="token operator">=</span> doc<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span> doc<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop
    <span class="token keyword">let</span> img
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> n<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      img <span class="token operator">=</span> images<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>offsetTop <span class="token operator">&lt;</span> cHeight <span class="token operator">+</span> scrollTop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">loadImage</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
        <span class="token operator">++</span>n
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>这里采用了闭包的实现方式主要是为了缓存变量。其中，判断元素是否可视区范围
内我们上面已经讲过了。值得注意的是，我们这里声明了变量 <code>n</code> 用于记录当前已经加载
完成的图片的数量。</p> <p>再来看 <code>loadImage</code> 的实现：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>img <span class="token operator">||</span> <span class="token operator">!</span>img <span class="token keyword">instanceof</span> <span class="token class-name">HTMLImageElement</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>img<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not a HTMLImageElement</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  img<span class="token punctuation">.</span>src <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-src'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span>
  img<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'data-src'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>像我们之前说的，加载图片的过程就是获取 <code>img.dataset['src']</code> 后，赋值给 <code>img.src</code>，
最后再把 <code>img.dataset['src']</code> 删除。</p> <p>最后，再来回答我们为什么要使用节流函数了。主要还是 <code>scroll</code> 触发太快的缘故，这就是节流
函数的使用初衷。</p> <h2 id="图片预加载"><a href="#图片预加载" class="header-anchor">#</a> 图片预加载</h2> <p>图片预加载指的是在图片打开前将图片加载到用户本地，当需要时再进行渲染。</p> <p>图片预加载有两种方式：</p> <ol><li>无序加载。</li> <li>有序加载。</li></ol> <p>其核心是通过 javascript 提供的 <code>Image</code> 对象实现的。</p> <h3 id="无序加载"><a href="#无序加载" class="header-anchor">#</a> 无序加载</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.container'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/1.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/2.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/3.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic3'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/4.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic4'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/5.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic5'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic6'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 测试异常图片</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/6.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic6'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/7.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic7'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/8.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic8'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> length <span class="token operator">=</span> data<span class="token punctuation">.</span>length
<span class="token keyword">const</span> imgList <span class="token operator">=</span> <span class="token function">mapImage</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">imageList</span> <span class="token operator">=&gt;</span>
  <span class="token function">addChildren</span><span class="token punctuation">(</span>imageList<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> src
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    img<span class="token punctuation">.</span>onerror <span class="token operator">=</span> reject
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">mapImage</span><span class="token punctuation">(</span><span class="token parameter">images</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> length <span class="token operator">=</span> images<span class="token punctuation">.</span>length
    <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> image <span class="token operator">=</span> images<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token function">loadImage</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">img</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
          count<span class="token operator">++</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> length<span class="token punctuation">)</span> <span class="token function">resolve</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          count<span class="token operator">++</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> length<span class="token punctuation">)</span> <span class="token function">resolve</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">addChildren</span><span class="token punctuation">(</span><span class="token parameter">children<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    parent<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token operator">...</span>children<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>为了更好地看出是无序加载，我们可以修改一下 <code>loadImage</code> 的代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> time <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> src
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    img<span class="token punctuation">.</span>onerror <span class="token operator">=</span> reject
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img src="data:image/png;base64,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" alt=""></p> <h3 id="有序加载"><a href="#有序加载" class="header-anchor">#</a> 有序加载</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.container'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/1.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/2.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/3.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic3'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/4.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic4'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/5.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic5'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/6.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic6'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/7.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic7'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> src<span class="token operator">:</span> <span class="token string">'images/8.png'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'pic8'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> length <span class="token operator">=</span> data<span class="token punctuation">.</span>length
<span class="token keyword">const</span> imgPromiseList <span class="token operator">=</span> <span class="token function">loadImages</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>imgPromiseList<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">images</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">addChildren</span><span class="token punctuation">(</span>images<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> time <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>src<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'invalid src'</span><span class="token punctuation">)</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> src
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    img<span class="token punctuation">.</span>onerror <span class="token operator">=</span> reject
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">loadImages</span><span class="token punctuation">(</span><span class="token parameter">imgUrlList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> imgUrlList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">loadImage</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">addChildren</span><span class="token punctuation">(</span><span class="token parameter">children<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    parent<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token operator">...</span>children<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>这里使用 <code>Promise.all</code> 将所有的 <code>Promise</code> <code>resolve</code> 掉，
但问题在于，如果其中一个 <code>Promise</code> 被 <code>rejected</code> 的话，那么
我们就拿不到已经加载完成的图片了。</p> <p>下面对此进行优化，
这里主要是修改 <code>Promise.all</code> 的代码即可：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ...</span>
<span class="token keyword">const</span> length <span class="token operator">=</span> data<span class="token punctuation">.</span>length
<span class="token keyword">const</span> imgPromiseList <span class="token operator">=</span> <span class="token function">loadImages</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> images <span class="token operator">=</span> <span class="token function">ensureOrder</span><span class="token punctuation">(</span>imgPromiseList<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">images</span> <span class="token operator">=&gt;</span>
    <span class="token function">addChildren</span><span class="token punctuation">(</span>
      images<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      container<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">ensureOrder</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> length <span class="token operator">=</span> promises<span class="token punctuation">.</span>length
    <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span>
    promises<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// debugger</span>
      promise
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
          list<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> value
          <span class="token operator">++</span>count <span class="token operator">===</span> length <span class="token operator">&amp;&amp;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          list<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
          <span class="token operator">++</span>count <span class="token operator">===</span> length <span class="token operator">&amp;&amp;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">September 10, 2021 20:58</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 15622971239@163.com" class="contributor">
          Laishuxin
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog_fe/cate/js/3-throttle/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        js - 防抖
      </a></span> <span class="next"><a href="/blog_fe/cate/js/5-functional-programming/">
        js - 函数式编程
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <!----> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><!----> <div class="footer"><h2 style="width:100%; min-width: 100%;">Ru Shui</h2></div> <div class="copyright">MIT Licensed | Copyright © 2021-present Ru Shui</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/blog_fe/assets/js/app.fe1b108c.js" defer></script><script src="/blog_fe/assets/js/layout-Layout.7bf019d1.js" defer></script><script src="/blog_fe/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.aaefc311.js" defer></script><script src="/blog_fe/assets/js/page-js-懒加载与预加载.636d3a83.js" defer></script><script src="/blog_fe/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.08f9f3fe.js" defer></script><script src="/blog_fe/assets/js/vendors~layout-Blog~layout-Layout.d98152e8.js" defer></script>
  </body>
</html>
